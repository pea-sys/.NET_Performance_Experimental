以下書籍の和訳書のハンズオン  
https://www.manning.com/books/unit-testing

---

[メモ]

- 単体テストとは以下の 3 つの性質を持ったテスト
  - 1 単位の振る舞いを検証すること
  - 実行時間が短いこと
  - 他のテストケースから隔離された状態で実行されること
- 統合テストとは、上記 3 つの性質の 1 つでも損なっているテスト

* E2E テストは統合テストの 1 種。全てのプロセス外依存を使うテストする

---

- 単体テストには、ロンドン学派と古典学派の２つの学派が存在する
  - ロンドン学派：単体とは 1 単位のコード(クラス)を指す。すべての不変依存をテストダブルに置き換える
  - 古典学派：単体とは 1 単位のテストケースを指す。他のテストケースに影響を与える可能性のある共有依存のみテストダブルに置き換える
    (※日本における TDD の第一人者は古典学派。基本的にモックは使わないにこしたことはないという考え。)

* 最も質の高いテストである出力値ベースのテストを可能な限り導入する。

- 関数型アーキテクチャを採用すると保守性は向上するがパフォーマンスは犠牲になる。
- 対価が得られない場合は関数型アーキテクチャを採用する必要はない。
- プロセス外依存をドメイン・モデルに持ち込んではいけない。
- 副作用を起こす処理をビジネス・オペレーションの最後まで実行させないようにすることで単体テストを可能にする。

- 通常データベースはテスト対象アプリ以外からアクセスされることは稀なので、モックに置き換える必要がない場合がほとんど。

- 単体テストでは異常系を出来るだけ多く検証し、統合テストでは単体テストでカバーできない異常系と正常系を検証することでテストピラミッドが適切なバランスになりやすくなる。

---

[参考]  
[モックは必要悪で、しないにこしたことはない](https://blog.8-p.info/ja/2021/10/12/mock/)
